{
  "entities": {
    "Employee": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Employee",
      "type": "object",
      "description": "Represents an employee within the HighClass HR Automation system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Employee entity."
        },
        "firstName": {
          "type": "string",
          "description": "The employee's first name."
        },
        "lastName": {
          "type": "string",
          "description": "The employee's last name."
        },
        "employeeId": {
          "type": "string",
          "description": "The unique indentifier asigned to the employee by the company."
        },
        "email": {
          "type": "string",
          "description": "The employee's email address.",
          "format": "email"
        },
        "phoneNumber": {
          "type": "string",
          "description": "The employee's phone number."
        },
        "hireDate": {
          "type": "string",
          "description": "The date the employee was hired.",
          "format": "date-time"
        },
        "jobTitle": {
          "type": "string",
          "description": "The employee's job title."
        },
        "department": {
          "type": "string",
          "description": "The department the employee belongs to."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "employeeId",
        "email",
        "phoneNumber",
        "hireDate",
        "jobTitle",
        "department"
      ]
    },
    "AttendanceRecord": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AttendanceRecord",
      "type": "object",
      "description": "Represents an employee's attendance record, including check-in and check-out times.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AttendanceRecord entity."
        },
        "employeeId": {
          "type": "string",
          "description": "Reference to Employee. (Relationship: Employee 1:N AttendanceRecord)"
        },
        "checkInTime": {
          "type": "string",
          "description": "The time the employee checked in.",
          "format": "date-time"
        },
        "checkOutTime": {
          "type": "string",
          "description": "The time the employee checked out.",
          "format": "date-time"
        },
        "date": {
          "type": "string",
          "description": "The date of the attendance record.",
          "format": "date-time"
        },
        "location": {
          "type": "string",
          "description": "The location from where the check-in/out was recorded (e.g., GPS coordinates)."
        }
      },
      "required": [
        "id",
        "employeeId",
        "checkInTime",
        "checkOutTime",
        "date",
        "location"
      ]
    },
    "PayrollRecord": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PayrollRecord",
      "type": "object",
      "description": "Represents a payroll record for an employee for a specific period.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the PayrollRecord entity."
        },
        "employeeId": {
          "type": "string",
          "description": "Reference to Employee. (Relationship: Employee 1:N PayrollRecord)"
        },
        "startDate": {
          "type": "string",
          "description": "The start date of the payroll period.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "The end date of the payroll period.",
          "format": "date-time"
        },
        "grossPay": {
          "type": "number",
          "description": "The employee's gross pay for the period."
        },
        "deductions": {
          "type": "number",
          "description": "The total deductions for the employee for the period."
        },
        "netPay": {
          "type": "number",
          "description": "The employee's net pay for the period."
        },
        "paymentDate": {
          "type": "string",
          "description": "The date the employee was paid.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "employeeId",
        "startDate",
        "endDate",
        "grossPay",
        "deductions",
        "netPay",
        "paymentDate"
      ]
    },
    "Deduction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Deduction",
      "type": "object",
      "description": "Represents a deduction applied to an employee's payroll.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Deduction entity."
        },
        "payrollRecordId": {
          "type": "string",
          "description": "Reference to PayrollRecord. (Relationship: PayrollRecord 1:N Deduction)"
        },
        "deductionType": {
          "type": "string",
          "description": "The type of deduction (e.g., tax, insurance)."
        },
        "amount": {
          "type": "number",
          "description": "The amount of the deduction."
        },
        "description": {
          "type": "string",
          "description": "A description of the deduction."
        }
      },
      "required": [
        "id",
        "payrollRecordId",
        "deductionType",
        "amount",
        "description"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/employees/{employeeId}",
        "definition": {
          "entityName": "Employee",
          "schema": {
            "$ref": "#/backend/entities/Employee"
          },
          "description": "Stores employee profiles. Path-based ownership is applied through the employeeId parameter.",
          "params": [
            {
              "name": "employeeId",
              "description": "The unique identifier for the employee."
            }
          ]
        }
      },
      {
        "path": "/employees/{employeeId}/attendanceRecords/{attendanceRecordId}",
        "definition": {
          "entityName": "AttendanceRecord",
          "schema": {
            "$ref": "#/backend/entities/AttendanceRecord"
          },
          "description": "Stores attendance records for each employee. Includes denormalized 'employeeId' for authorization independence.",
          "params": [
            {
              "name": "employeeId",
              "description": "The unique identifier for the employee."
            },
            {
              "name": "attendanceRecordId",
              "description": "The unique identifier for the attendance record."
            }
          ]
        }
      },
      {
        "path": "/employees/{employeeId}/payrollRecords/{payrollRecordId}",
        "definition": {
          "entityName": "PayrollRecord",
          "schema": {
            "$ref": "#/backend/entities/PayrollRecord"
          },
          "description": "Stores payroll records for each employee. Includes denormalized 'employeeId' for authorization independence.",
          "params": [
            {
              "name": "employeeId",
              "description": "The unique identifier for the employee."
            },
            {
              "name": "payrollRecordId",
              "description": "The unique identifier for the payroll record."
            }
          ]
        }
      },
      {
        "path": "/employees/{employeeId}/payrollRecords/{payrollRecordId}/deductions/{deductionId}",
        "definition": {
          "entityName": "Deduction",
          "schema": {
            "$ref": "#/backend/entities/Deduction"
          },
          "description": "Stores deduction records for each payroll record. Ensures proper nesting of deduction records within the payroll and employee context.",
          "params": [
            {
              "name": "employeeId",
              "description": "The unique identifier for the employee."
            },
            {
              "name": "payrollRecordId",
              "description": "The unique identifier for the payroll record."
            },
            {
              "name": "deductionId",
              "description": "The unique identifier for the deduction."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the HighClass HR Automation system, focusing on secure, scalable, and easily debuggable data management. The structure is built around the entities: Employees, AttendanceRecords, PayrollRecords, and Deductions. Each entity is stored in its own collection, and where applicable, hierarchical paths are used to represent relationships between entities.\n\n**Authorization Independence:**\nTo ensure Authorization Independence, employeeId is denormalized in the AttendanceRecord and PayrollRecord collections. This allows direct querying and securing of these records based on the employee's ID without needing to perform `get()` calls to the Employees collection. This approach is especially important for maintaining atomicity in operations such as creating attendance or payroll records.\n\n**Structural Segregation:**\nEach entity type is stored in its own collection, ensuring a homogeneous security posture. For instance, all documents within the 'employees' collection share the same security requirements. This segregation simplifies the security rules and makes the system more maintainable.\n\n**Access Modeling:**\nPath-based ownership is used to manage access to employee-specific data. For example, attendance records are stored under `/employees/{employeeId}/attendanceRecords/{attendanceRecordId}`, ensuring that only the employee or authorized personnel can access these records. This pattern provides a clear and efficient way to define ownership and enforce access control.\n\n**QAPs (Rules are not Filters):**\nThe structure supports secure `list` operations by using path-based ownership. Security rules can be written to allow listing of attendance records only for a specific employee, based on the `employeeId` in the path. This prevents unauthorized access to other employees' attendance data.\n\nThis structure supports the requested features, including attendance tracking, payroll generation, and deduction management, while adhering to the core design principles of Authorization Independence, Structural Segregation, and Access Modeling."
  }
}