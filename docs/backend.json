{
  "entities": {
    "Employee": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Employee",
      "type": "object",
      "description": "Represents an employee within the HighClass HR Automation system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Employee entity."
        },
        "firstName": {
          "type": "string",
          "description": "The employee's first name."
        },
        "lastName": {
          "type": "string",
          "description": "The employee's last name."
        },
        "employeeId": {
          "type": "string",
          "description": "The employee ID assigned by the company."
        },
        "email": {
          "type": "string",
          "description": "The employee's email address.",
          "format": "email"
        },
        "phoneNumber": {
          "type": "string",
          "description": "The employee's phone number."
        },
        "departmentId": {
          "type": "string",
          "description": "Reference to Department. (Relationship: Department 1:N Employee)"
        },
        "hireDate": {
          "type": "string",
          "description": "The date the employee was hired.",
          "format": "date-time"
        },
        "jobTitle": {
          "type": "string",
          "description": "The employee's job title."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "employeeId",
        "email",
        "departmentId",
        "hireDate",
        "jobTitle"
      ]
    },
    "Department": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Department",
      "type": "object",
      "description": "Represents a department within the company.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Department entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the department."
        },
        "description": {
          "type": "string",
          "description": "A description of the department."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "AttendanceRecord": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AttendanceRecord",
      "type": "object",
      "description": "Represents an individual attendance record for an employee.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AttendanceRecord entity."
        },
        "employeeId": {
          "type": "string",
          "description": "Reference to Employee. (Relationship: Employee 1:N AttendanceRecord)"
        },
        "checkInTime": {
          "type": "string",
          "description": "The time the employee checked in.",
          "format": "date-time"
        },
        "checkOutTime": {
          "type": "string",
          "description": "The time the employee checked out.",
          "format": "date-time"
        },
        "location": {
          "type": "string",
          "description": "The location (e.g., GPS coordinates) of the check-in/out."
        },
        "qrCodeData": {
          "type": "string",
          "description": "The data from the QR code that was scanned."
        }
      },
      "required": [
        "id",
        "employeeId",
        "checkInTime"
      ]
    },
    "PayrollRecord": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PayrollRecord",
      "type": "object",
      "description": "Represents a payroll record for an employee for a specific period.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the PayrollRecord entity."
        },
        "employeeId": {
          "type": "string",
          "description": "Reference to Employee. (Relationship: Employee 1:N PayrollRecord)"
        },
        "payPeriodStart": {
          "type": "string",
          "description": "The start date of the pay period.",
          "format": "date-time"
        },
        "payPeriodEnd": {
          "type": "string",
          "description": "The end date of the pay period.",
          "format": "date-time"
        },
        "grossPay": {
          "type": "number",
          "description": "The employee's gross pay for the period."
        },
        "deductions": {
          "type": "number",
          "description": "Total deductions for the period."
        },
        "netPay": {
          "type": "number",
          "description": "The employee's net pay for the period."
        }
      },
      "required": [
        "id",
        "employeeId",
        "payPeriodStart",
        "payPeriodEnd",
        "grossPay",
        "deductions",
        "netPay"
      ]
    },
    "QrCode": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "QrCode",
      "type": "object",
      "description": "Represents a QR code generated by the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the QR code."
        },
        "employeeId": {
          "type": "string",
          "description": "Reference to Employee. (Relationship: Employee 1:N QrCode)"
        },
        "generatedDate": {
          "type": "string",
          "description": "The date and time the QR code was generated.",
          "format": "date-time"
        },
        "expirationDate": {
          "type": "string",
          "description": "The date and time the QR code expires.",
          "format": "date-time"
        },
        "codeData": {
          "type": "string",
          "description": "The actual QR code data."
        }
      },
      "required": [
        "id",
        "employeeId",
        "generatedDate",
        "expirationDate",
        "codeData"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/employees/{employeeId}",
        "definition": {
          "entityName": "Employee",
          "schema": {
            "$ref": "#/backend/entities/Employee"
          },
          "description": "Stores employee data. Uses path-based ownership. Includes employeeId as a parameter for direct access.",
          "params": [
            {
              "name": "employeeId",
              "description": "The unique identifier for the employee."
            }
          ]
        }
      },
      {
        "path": "/departments/{departmentId}",
        "definition": {
          "entityName": "Department",
          "schema": {
            "$ref": "#/backend/entities/Department"
          },
          "description": "Stores department data. Uses path-based ownership. Includes departmentId as a parameter for direct access.",
          "params": [
            {
              "name": "departmentId",
              "description": "The unique identifier for the department."
            }
          ]
        }
      },
      {
        "path": "/employees/{employeeId}/attendanceRecords/{attendanceRecordId}",
        "definition": {
          "entityName": "AttendanceRecord",
          "schema": {
            "$ref": "#/backend/entities/AttendanceRecord"
          },
          "description": "Stores attendance records for each employee.  Nested under the employee path to enforce ownership. Includes employeeId and attendanceRecordId as parameters.",
          "params": [
            {
              "name": "employeeId",
              "description": "The unique identifier for the employee."
            },
            {
              "name": "attendanceRecordId",
              "description": "The unique identifier for the attendance record."
            }
          ]
        }
      },
      {
        "path": "/employees/{employeeId}/payrollRecords/{payrollRecordId}",
        "definition": {
          "entityName": "PayrollRecord",
          "schema": {
            "$ref": "#/backend/entities/PayrollRecord"
          },
          "description": "Stores payroll records for each employee. Nested under the employee path to enforce ownership. Includes employeeId and payrollRecordId as parameters.",
          "params": [
            {
              "name": "employeeId",
              "description": "The unique identifier for the employee."
            },
            {
              "name": "payrollRecordId",
              "description": "The unique identifier for the payroll record."
            }
          ]
        }
      },
      {
        "path": "/employees/{employeeId}/qrCodes/{qrCodeId}",
        "definition": {
          "entityName": "QrCode",
          "schema": {
            "$ref": "#/backend/entities/QrCode"
          },
          "description": "Stores QR codes generated for each employee. Nested under the employee path to enforce ownership. Includes employeeId and qrCodeId as parameters.",
          "params": [
            {
              "name": "employeeId",
              "description": "The unique identifier for the employee."
            },
            {
              "name": "qrCodeId",
              "description": "The unique identifier for the QR code."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "role_admin",
          "schema": {
            "$ref": "#/backend/entities/Employee"
          },
          "description": "Stores the id of admin users. Existence of document determines admin rights.  No data is actually stored in documents. Existence over Content.",
          "params": [
            {
              "name": "userId",
              "description": "User ID of the admin"
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the HighClass HR Automation system, focusing on secure, scalable, and easily maintainable data storage. Key considerations include authorization independence, clarity of intent, and adherence to the DBAC (Database-Based Access Control) principle.\n\n**Authorization Independence:** To avoid hierarchical authorization dependencies, the structure denormalizes authorization-related data. For example, if access to AttendanceRecords needs to be restricted to specific departments or roles, the relevant role information would be duplicated within the AttendanceRecord documents themselves.\n\n**Structural Segregation:** Data is segregated into collections based on access needs. User-specific data is stored under `/users/{userId}` to enforce ownership. Shared or collaborative data utilizes membership maps.\n\n**Access Modeling:** Path-based ownership is employed where applicable (e.g., employees' QR codes). Membership maps are used for collaborative entities (though none exist in the given data model).\n\n**QAPs (Rules are not Filters):** The design accounts for secure `list` operations. The data segregation strategy ensures that listing documents within a collection only returns documents the user is authorized to access.\n\nThe structure ensures Authorization Independence (CRITICAL), supporting the required QAPs (using segregation and/or membership models)."
  }
}